<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracking DO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar navbar-ut">
        <div class="container">
            <span class="navbar-brand">Sistem Informasi Bahan Ajar</span>
            <div class="d-flex gap-3">
                <a href="index.html" class="nav-link-ut">Home</a>
                <a href="stok.html" class="nav-link-ut">Stok Bahan Ajar</a>
                <a href="tracking.html" class="nav-link-ut active">Tracking DO</a>
            </div>
        </div>
    </nav>

    <div id="trackingApp" class="container mt-5 mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark">Tracking Delivery Order</h3>
            <button class="btn-black" @click="bukaModalDO"><i class="fas fa-plus"></i> Buat DO Baru</button>
        </div>

        <div class="search-container">
            <label class="fw-bold small mb-2">Cari Nomor DO</label>
            <input type="text" v-model="searchQuery" class="form-control bg-light" placeholder="Masukkan Nomor DO / Nama..." aria-label="Search">
        </div>

        <div v-if="filteredTracking.length > 0">
            <div class="do-card" v-for="item in filteredTracking" :key="item.noDO">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="fw-bold"><i class="fas fa-box me-2"></i>{{ item.noDO }}</h5>
                        <div class="text-muted small">NIM: {{ item.nim }} | Nama: {{ item.nama }}</div>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge rounded-pill bg-primary bg-opacity-10 text-primary p-2">{{ item.status }}</span>
                        <button class="btn btn-sm btn-outline-secondary" title="Cetak" @click="cetakInvoice(item)" aria-label="Cetak"><i class="fas fa-print"></i></button>
                        <button class="btn btn-sm btn-outline-danger" title="Hapus" @click="hapusDO(item)" aria-label="Hapus"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-4"><small class="text-muted">Ekspedisi</small><div class="fw-bold">{{ item.ekspedisi }}</div></div>
                    <div class="col-md-4"><small class="text-muted">Paket</small><div class="fw-bold">{{ item.paket }}</div></div>
                    <div class="col-md-4"><small class="text-muted">Total</small><div class="fw-bold">{{ formatRupiah(item.total) }}</div></div>
                </div>
                <hr class="mt-4 mb-4">
                <h6 class="fw-bold text-secondary mb-3">Riwayat Perjalanan</h6>
                <div class="timeline" v-if="item.perjalanan">
                    <div class="timeline-item" v-for="(log, idx) in item.perjalanan" :key="idx">
                        <div class="timeline-point"></div>
                        <div class="timeline-time">{{ log.waktu }}</div>
                        <div class="timeline-desc">{{ log.keterangan }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div v-else class="text-center py-5 text-muted">Data tidak ditemukan</div>

        <div class="modal fade" id="modalDO" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content p-3">
                    <div class="modal-header border-0">
                        <h5 class="modal-title fw-bold">Buat Delivery Order Baru</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="submitDO">
                            <div class="mb-3"><label class="small fw-bold">Nomor DO</label><input :value="generatedDONumber" class="form-control bg-light" disabled aria-label="No DO"></div>
                            <div class="row g-3">
                                <div class="col-md-6"><label class="small fw-bold">NIM *</label><input v-model="form.nim" class="form-control form-control-modal" required aria-label="NIM"></div>
                                <div class="col-md-6"><label class="small fw-bold">Nama *</label><input v-model="form.nama" class="form-control form-control-modal" required aria-label="Nama"></div>
                                <div class="col-md-6"><label class="small fw-bold">Ekspedisi *</label>
                                    <select v-model="form.ekspedisi" class="form-select form-control-modal" required aria-label="Ekspedisi">
                                        <option v-for="e in pengirimanList" :value="e.nama">{{ e.nama }}</option>
                                    </select>
                                </div>
                                <div class="col-md-6"><label class="small fw-bold">Tanggal Kirim</label><input type="date" v-model="form.tanggalKirim" class="form-control form-control-modal" required aria-label="Tgl Kirim"></div>
                                <div class="col-12"><label class="small fw-bold">Paket *</label>
                                    <select v-model="form.paket" class="form-select form-control-modal" required aria-label="Paket">
                                        <option v-for="p in paketList" :value="p.kode">{{ p.kode }} - {{ p.nama }}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end gap-2 mt-4">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Batal</button>
                                <button type="submit" class="btn btn-black">Buat DO</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>&copy; 2025 Universitas Terbuka</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="js/dataBahanAjar.js"></script>
    <script src="js/tracking-app.js"></script>
</body>
</html>